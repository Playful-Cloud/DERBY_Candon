<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Results</title>
    <!-- Include jQuery and DataTables CSS/JS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .container {
            max-width: 2300px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        h1 { text-align: center; }
        #resultsTable {
            margin: 0 auto;
            width: 100%;
            border-collapse: collapse;
        }
        #resultsTable th, #resultsTable td {
            padding: 10px 15px;
            text-align: left;
            vertical-align: left;
            word-wrap: break-word;
        }
        #resultsTable th {
            font-size: 1.2rem;
            background-color: #f4f4f4;
        }
        #resultsTable th, #resultsTable td {
            word-wrap: break-word;
        }
        .notes-section {
            margin-top: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }
        .notes-section p {
            font-size: 1rem;
            color: #555;
        }
        .tabs-nav {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }
        .tabs-nav button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        .tabs-nav button.active {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BBC-Manila NDR - DERBY as of 3rd LAP - Candon</h1>
            <p> Initial Unofficial Result </p>
        
        <!-- Navigation for Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn" data-tab="YB">YB</button>
            <button class="tab-btn" data-tab="FR2">FR2</button>
            <button class="tab-btn" data-tab="Tab3">Tab3</button>
            <!-- Add more buttons as needed -->
        </div>

        <table id="resultsTable" class="display">
            <thead>
                <tr>
                    <!-- Headers will be dynamically loaded -->
                </tr>
            </thead>
            <tbody>
                <!-- Data will be dynamically loaded -->
            </tbody>
        </table>

        <div class="notes-section">
            <h2>Notes for Viewers</h2>
            <p>
                Please note that the race results are displayed based on various factors, including performance in different locations such as Bauang, Balaoan, and Candon. The "TOTAL SPEED" represents the aggregate speed of the birds across these locations...
            </p>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Replace with your Google Sheet ID and API Key
            const sheetId = "1B8vkEiOwZlNndMv5q5Ado3BXNXYystDciV9_r2wpQQk"; // Your sheet ID
            const apiKey = "AIzaSyBBRTnPTyQEHizMS9xv4tVbDAR0xYRA87k"; // Your API Key

            // Default tab (YB)
            let activeTab = 'YB';

            // Function to load data and headers
            function loadData(tab) {
                const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${tab}?key=${apiKey}`;

                $.getJSON(apiUrl, function(data) {
                    console.log("API Response:", data); // Log the response to the console
                    
                    // Clear current data
                    let tableHeaders = '';
                    let tableData = '';

                    if (data && data.values && data.values.length > 1) {
                        // Dynamically build table headers based on the first row
                        data.values[0].forEach(function(header) {
                            tableHeaders += `<th>${header}</th>`;
                        });

                        // Loop through data and add to the table
                        data.values.slice(1).forEach(function(row) {
                            tableData += "<tr>";
                            row.forEach(function(cell) {
                                tableData += `<td>${cell || ''}</td>`;  // Safely handle empty or undefined values
                            });
                            tableData += "</tr>";
                        });
                    } else {
                        console.error("Data is missing or incorrectly formatted:", data);
                    }

                    // Populate table
                    $('#resultsTable thead tr').html(tableHeaders);
                    $('#resultsTable tbody').html(tableData);

                    // Reinitialize DataTable after updating the content
                    $('#resultsTable').DataTable();
                }).fail(function(err) {
                    console.error("Error fetching data: ", err);
                    $("#resultsTable tbody").html("<tr><td colspan='9'>Failed to fetch data from Google Sheets. Check the console for errors.</td></tr>");
                });
            }

            // Load the default tab on initial load
            loadData(activeTab);

            // Tab click handler
            $('.tab-btn').click(function() {
                // Remove active class from all buttons
                $('.tab-btn').removeClass('active');
                
                // Add active class to the clicked button
                $(this).addClass('active');

                // Get the tab name from the button data attribute
                activeTab = $(this).data('tab');

                // Load the data for the selected tab
                loadData(activeTab);
            });

            // Activate the first tab by default
            $('.tab-btn').first().addClass('active');
        });
    </script>
</body>
</html>
