<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Results</title>
    <!-- Include jQuery and DataTables CSS/JS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

    <style>
        body { font-family: Arial, sans-serif; }
        .container {
            max-width: 2300px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        h1 { text-align: center; }
        #resultsTable {
            margin: 0 auto;
            width: 100%;
            border-collapse: collapse;
        }
        #resultsTable th, #resultsTable td {
            padding: 10px 15px;
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
            max-width: 200px; /* Limit column width */
            overflow: hidden; /* Hide overflowing text */
            text-overflow: ellipsis; /* Add ellipsis for overflow */
        }
        #resultsTable th {
            font-size: 1.2rem;
            background-color: #f4f4f4;
        }
        #resultsTable th {
            white-space: nowrap; /* Prevent text wrapping */
            overflow: hidden; /* Hide overflowing text */
            text-overflow: ellipsis; /* Show ellipsis for long text */
        }
        .notes-section {
            margin-top: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }
        .notes-section p {
            font-size: 1rem;
            color: #555;
        }
        #loader {
            display: none;
            text-align: center;
        }
        #loader p {
            font-size: 1.2rem;
            color: #333;
        }
        @media (max-width: 768px) {
            #resultsTable th, #resultsTable td {
                font-size: 0.9rem;
                padding: 8px;
            }
            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BBC-Manila NDR - DERBY as of 3rd LAP - Candon</h1>
        <p> Initial Unofficial Result </p>

        <!-- Navigation for Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn" data-tab="YB">YB</button>
            <button class="tab-btn" data-tab="FR2">FR2</button>
            <button class="tab-btn" data-tab="FR3">FR3</button>
            <!-- Add more buttons as needed -->
        </div>

        <table id="resultsTable" class="display">
            <thead>
                <tr>
                    <!-- Headers will be dynamically loaded -->
                </tr>
            </thead>
            <tbody>
                <!-- Data will be dynamically loaded -->
            </tbody>
        </table>

        <div class="notes-section">
            <h2>Notes for Viewers</h2>
            <p>
                Please note that the race results are displayed based on various factors, including performance in different locations such as Bauang, Balaoan, and Candon. The "TOTAL SPEED" represents the aggregate speed of the birds across these locations...
            </p>
        </div>
    </div>

    <script>


        

    $(document).ready(function() {
    const apiKey = 'AIzaSyDnQPBVIY-hChWThux9R8WknqvuDHsDFog'; // Your API key
    const raceDataUrls = {
        YB: 'https://sheets.googleapis.com/v4/spreadsheets/1B8vkEiOwZlNndMv5q5Ado3BXNXYystDciV9_r2wpQQk/values/YB!A3:J85?key=' + apiKey,
        FR2: 'https://sheets.googleapis.com/v4/spreadsheets/1B8vkEiOwZlNndMv5q5Ado3BXNXYystDciV9_r2wpQQk/values/FR2!A3:J85?key=' + apiKey,
        FR3: 'https://sheets.googleapis.com/v4/spreadsheets/1B8vkEiOwZlNndMv5q5Ado3BXNXYystDciV9_r2wpQQk/values/FR3!A3:J85?key=' + apiKey
    };

    let dataTable; // To store the DataTable instance
    let activeTab = 'YB'; // Default active tab (can be changed based on the tab)

    // Function to initialize or reinitialize DataTable
    function initDataTable() {
        if (dataTable) {
            // Destroy previous instance
            dataTable.destroy();
        }
        // Reinitialize DataTable
        dataTable = $('#resultsTable').DataTable({
            destroy: true, // Ensure previous instance is removed
            autoWidth: false, // Disable auto-width for better control
            responsive: true // Ensure responsive table
        });
    }

    // Function to load data for a specific tab (YB, FR2, FR3)
    function loadData(tab) {
        const apiUrl = raceDataUrls[tab]; // Get the URL based on the tab selected

        $.getJSON(apiUrl, function(data) {
            console.log(`Data for tab "${tab}":`, data);

            let tableHeaders = '';
            let tableData = '';

            if (data && data.values && data.values.length > 1) {
                // Dynamically build headers
                data.values[0].forEach(header => {
                    tableHeaders += `<th>${header}</th>`;
                });

                // Populate rows
                data.values.slice(1).forEach(row => {
                    tableData += "<tr>";
                    row.forEach(cell => {
                        tableData += `<td>${cell || ''}</td>`; // Handle undefined or empty cells
                    });
                    tableData += "</tr>";
                });
            } else {
                console.error("Invalid or missing data:", data);
            }

            // Update table structure
            $('#resultsTable thead tr').html(tableHeaders);
            $('#resultsTable tbody').html(tableData);

            // Reinitialize DataTable
            initDataTable();
        }).fail(err => {
            console.error("Error fetching data:", err);
            $('#resultsTable tbody').html('<tr><td colspan="100%">Failed to load data. Please try again later.</td></tr>');
        });
    }

    // Initial load for the default tab (YB)
    loadData(activeTab);
});

