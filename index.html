<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Results</title>
    <!-- Include jQuery and DataTables CSS/JS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
   
    <style>
        body { font-family: Arial, sans-serif; }
        .container {
            max-width: 2300px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        h1 { text-align: center; }
        #resultsTable {
            margin: 0 auto;
            width: 100%;
            border-collapse: collapse;
        }
        #resultsTable th, #resultsTable td {
            padding: 10px 15px;
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
            max-width: 200px; /* Limit column width */
            overflow: hidden; /* Hide overflowing text */
            text-overflow: ellipsis; /* Add ellipsis for overflow */
        }
        #resultsTable th {
            font-size: 1.2rem;
            background-color: #f4f4f4;
        }
        #loader {
            display: none;
            text-align: center;
        }
        #loader p {
            font-size: 1.2rem;
            color: #333;
        }
        @media (max-width: 768px) {
            #resultsTable th, #resultsTable td {
                font-size: 0.9rem;
                padding: 8px;
            }
            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BBC-Manila NDR - DERBY as of 3rd LAP - Candon</h1>
        <p>Initial Unofficial Result</p>
        
        <!-- Loader -->
        <div id="loader">
            <p>Loading data...</p>
        </div>
        
        <!-- Navigation for Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn" data-tab="YB">YB</button>
            <button class="tab-btn" data-tab="FR2">FR2</button>
            <button class="tab-btn" data-tab="FR3">Tab3</button>
            <!-- Add more buttons as needed -->
        </div>

        <table id="resultsTable" class="display">
            <thead>
                <tr>
                    <!-- Headers will be dynamically loaded -->
                </tr>
            </thead>
            <tbody>
                <!-- Data will be dynamically loaded -->
            </tbody>
        </table>
    </div>

    <script>
        const sheetId = "1B8vkEiOwZlNndMv5q5Ado3BXNXYystDciV9_r2wpQQk"; // Your sheet ID
        const apiKey = "AIzaSyBBRTnPTyQEHizMS9xv4tVbDAR0xYRA87k"; // Your API Key

        let dataTable;

        // Show or hide the loader
        function showLoader(show) {
            $('#loader').toggle(show);
            $('#resultsTable').toggle(!show);
        }

        // Fetch data from Google Sheets API
        function fetchData(sheetName) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`;
            showLoader(true); // Show loader before fetching data
            $.getJSON(url, function(data) {
                showLoader(false); // Hide loader after data fetch

                const rows = data.values;
                const table = dataTable; // Use existing DataTable instance

                table.clear(); // Clear existing data before adding new data

                if (rows && rows.length > 0) {
                    const headers = rows[0];
                    $('#resultsTable thead tr').empty();
                    headers.forEach(header => {
                        $('#resultsTable thead tr').append(`<th>${header}</th>`);
                    });

                    // Add data rows
                    for (let i = 1; i < rows.length; i++) {
                        table.row.add(rows[i]);
                    }
                    table.draw();
                } else {
                    $('#resultsTable tbody').html(`
                        <tr>
                            <td colspan="100%" style="text-align: center; color: red;">
                                No data available for ${sheetName}.
                            </td>
                        </tr>
                    `);
                }
            }).fail(err => {
                showLoader(false); // Hide loader on error
                $('#resultsTable tbody').html(`
                    <tr>
                        <td colspan="100%" style="text-align: center; color: red;">
                            Unable to load data for ${sheetName}. Please check your connection or try again later.
                        </td>
                    </tr>
                `);
                console.error("Error loading data:", err);
            });
        }

        // Initialize DataTable
        $(document).ready(function() {
            // Initialize DataTable only once on page load
            dataTable = $('#resultsTable').DataTable();

            // Event listeners for tab buttons
            $('.tab-btn').on('click', function() {
                const sheetName = $(this).data('tab');
                fetchData(sheetName); // Load the selected tab's data
            });

            // Load default tab data on page load (you can set this to any default sheet)
            fetchData("YB");
        });
    </script>
</body>
</html>
