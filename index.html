<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Results</title>
    <!-- Include jQuery and DataTables CSS/JS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .container {
            max-width: 2300px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        h1 { text-align: center; }
        #resultsTable {
            margin: 0 auto;
            width: 100%;
            border-collapse: collapse;
        }
        #resultsTable th, #resultsTable td {
            padding: 10px 15px;
            text-align: left;
            vertical-align: left;
            word-wrap: break-word;
        }
        #resultsTable th {
            font-size: 1.2rem;
            background-color: #f4f4f4;
        }
        #resultsTable th, #resultsTable td {
            word-wrap: break-word;
        }
        #resultsTable th:nth-child(1), #resultsTable th:nth-child(3),
        #resultsTable th:nth-child(4), #resultsTable th:nth-child(5),
        #resultsTable th:nth-child(6), #resultsTable th:nth-child(7),
        #resultsTable th:nth-child(8), #resultsTable th:nth-child(9) {
            width: 12%;
        }
        .notes-section {
            margin-top: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }
        .notes-section p {
            font-size: 1rem;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BBCM - NDR - DERBY - YB - Candon - 3rd LAP</h1>
        <table id="resultsTable" class="display">
            <thead>
                <tr>
                    <th>COUNT</th>
                    <th class="name-column">NAME</th>
                    <th>RING_BAND</th>
                    <th>BAUANG</th>
                    <th>BALAOAN</th>
                    <th>CANDON</th>
                    <th>POINTS</th>
                    <th>TOTAL SPEED</th>
                    <th>RANK</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be loaded here via JavaScript -->
            </tbody>
        </table>

        <div class="notes-section">
            <h2>Notes for Viewers</h2>
            <p>
                Please note that the race results are displayed based on various factors, including performance in different locations such as Bauang, Balaoan, and Candon. The "TOTAL SPEED" represents the aggregate speed of the birds across these locations...
            </p>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Replace with your Google Sheet ID and API Key
            const sheetId = "1B8vkEiOwZlNndMv5q5Ado3BXNXYystDciV9_r2wpQQk"; // Your sheet ID
            const apiKey = "AIzaSyBBRTnPTyQEHizMS9xv4tVbDAR0xYRA87k"; // Your API Key
            
            // URL to fetch data from Google Sheets API with the correct tab name ("YB")
            const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/YB?key=${apiKey}`;

            // Fetch data from the Google Sheets API
            $.getJSON(apiUrl, function(data) {
                console.log("API Response:", data); // Log the response to the console
                
                let tableData = "";
                
                // Check if the data is valid
                if (data && data.values && data.values.length > 1) {
                    data.values.slice(1).forEach(function(row) {
                        // Ensure that the row has at least 9 cells
                        if (row.length >= 9) {
                            tableData += "<tr>";
                            row.forEach(function(cell) {
                                tableData += `<td>${cell || ''}</td>`;  // Safely handle empty or undefined values
                            });
                            tableData += "</tr>";
                        } else {
                            console.warn("Skipping row due to insufficient data:", row);
                        }
                    });
                } else {
                    console.error("Data is missing or incorrectly formatted:", data);
                }

                // Populate the DataTable body with the fetched data
                $('#resultsTable tbody').html(tableData);
                
                // Initialize DataTable after adding the data
                $('#resultsTable').DataTable();
            }).fail(function(err) {
                console.error("Error fetching data: ", err);
                $("#resultsTable").html("<tr><td colspan='9'>Failed to fetch data from Google Sheets. Check the console for errors.</td></tr>");
            });
        });
    </script>
</body>
</html>
